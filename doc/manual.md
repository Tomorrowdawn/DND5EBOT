# 编程小记

使用`Logger::logger`与`Event::processor`进行主要操作。每个`BotEvent`对象里面都带`Bot`,可以取到`Bot`的所有信息。

验证码相关:提示框中的URL复制到Chrome浏览器中，别急着滑，先`F12`打开审查界面，然后找到`Network`，再滑块完成，紧盯`Network`里面的`new_union_verify`，点开它，找到`ticket:"OOXX"`,复制`OOXX`即可（别把引号也复制了）。动作要快。

# 命名系统

# 地图系统

> 方格/六角格.先以方格为基准,但尽量向前兼容六角格为后期开发准备.

地图由一个地图格集合$M$组成.对于任意$m\in M$由一个坐标标定.此坐标对应于该格的左上角.该坐标对于外界是隐藏的,故而可以灵活地改变坐标系(方格,六角,三维均可).我们将指定一个坐标类来封装坐标内部的细节.坐标的单位默认是5尺.

地图上有两类位置标识:点与格.它们都以点来表征但含义不同.

# 特技系统

## 入口

任何行为都由一个入口`Entry`引发.例如火球术的入口为`施法者,施法起点`.其中施法者包含了诸如是否使用超魔等信息,这些信息在火球术函数内部将作为**预处理**信息被解析出来.当然,具体的响应方案是通过消息系统来实现的.因为人物的特殊能力千变万化,不可能在火球术内部全部取到;我们只需要发送一个释放了火球术的信号(这个信号内部可能包括伤害值,起点和范围)即可.例如有超魔使得火球术的范围扩大了一倍,那么这个信号会被此超魔接收到,该超魔将会强迫更远处的单位进行豁免并施加伤害值.

所有的改动都会被暂存起来,直至回合结束.此时写入所有改动,并且无法撤销.

## 施法

通过一张表来实现反射功能从而支持复杂的指令系统.

# 反应侦听系统

对地图格和任何单位附加一个`Effect`链表,同时建立一个全局信号侦听表.该侦听表由`{信号:[(效应处理函数,[源])]}`组成.源是一个可选项,没有就是空链表,表示可以触发该效应的单位.如果有其他方法获取源,这里就可以不重复储存(比如触发借机攻击时可以通过地图格来访问而无需储存),具体由该效应决定.同一信号可能有多种效应处理,按照优先级排列.

信号是`Msg`的一个子类,由该信号编写者决定其内容和结构.

效应处理函数要做如下动作:处理信号获取内容,获取响应源,构造入口,拉起效应函数.